<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>|| Szixi - Mikul√°s Sorsol√°s</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/BVY28GSb/1000003127-1.png">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');

        :root {
            --bg-dark: #001220;
            --szixi-blue: #002664;
            --szixi-gold: #D4AF37;
            --szixi-gold-bright: #FFD700;
            --santa-red: #C41E3A;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: white;
            font-family: 'Montserrat', sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .app-container {
            width: 100%;
            max-width: 100vw;
            aspect-ratio: 16/9;
            max-height: 100vh;
            background: radial-gradient(circle at 60% 50%, var(--szixi-blue), var(--bg-dark));
            position: relative;
            display: flex;
            flex-direction: row;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            overflow: hidden;
            border: 2px solid #111;
        }

        .snow-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.6;
        }

        .sidebar {
            width: 32%;
            height: 100%;
            padding: 3vh;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(to right, rgba(0,0,0,0.6), transparent);
            z-index: 10;
            border-right: 0px solid rgba(255,255,255,0.05);
        }

        .logo-box {
            margin-bottom: 2vh;
            filter: drop-shadow(0 0 15px rgba(212, 175, 55, 0.4));
            height: 20vh;
            display: flex;
            align-items: center;
        }

        .logo-box img {
            max-height: 200%;
            max-width: 200%;
            object-fit: contain;
        }

        h1 {
            font-size: 2.8vw;
            margin: 0;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 4px;
            background: linear-gradient(to bottom, var(--szixi-gold-bright), var(--szixi-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            line-height: 1.1;
        }

        .subtitle {
            font-size: 1.1vw;
            color: #aaa;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 3vh;
            margin-top: 1vh;
            font-weight: 300;
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 90%;
        }

        .stat-box {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            padding: 1.5vh;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .counter-number {
            font-size: 3vw;
            font-weight: 800;
            color: var(--santa-red);
            text-shadow: 0 2px 10px rgba(196, 30, 58, 0.5);
            line-height: 1;
        }

        #spinsLeftCounter {
            color: var(--szixi-gold-bright);
            text-shadow: 0 2px 10px rgba(212, 175, 55, 0.5);
        }

        .counter-label {
            font-size: 0.7vw;
            text-transform: uppercase;
            opacity: 0.8;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .wheel-section {
            flex-grow: 1;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2vh;
            box-sizing: border-box;
            gap: 3vh;
        }

        .wheel-wrapper-relative {
             position: relative;
             width: auto;
             height: auto;
             display: flex;
             justify-content: center;
        }

        .wheel-container {
            position: relative;
            height: 72vh;
            width: 72vh;
            filter: drop-shadow(0 25px 50px rgba(0,0,0,0.7));
            z-index: 5;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transform: rotate(0deg); 
        }

        .pointer {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; 
            height: 0; 
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-top: 60px solid var(--szixi-gold-bright);
            z-index: 20;
            filter: drop-shadow(0 5px 15px rgba(255, 215, 0, 0.4));
        }

        .center-hub {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 16%; height: 16%;
            background: radial-gradient(circle at top left, #fff, #ccc);
            border-radius: 50%;
            box-shadow: inset 0 -5px 10px rgba(0,0,0,0.2), 0 10px 20px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 15;
            border: 5px solid var(--szixi-gold);
        }
        
        .center-hub span { font-size: 4vh; }

        .controls {
            z-index: 50;
            display: flex;
            gap: 20px;
            justify-content: center;
            width: 100%;
        }

        button {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.1);
            color: var(--szixi-gold);
            padding: 1.5vh 4vh;
            font-size: 1.2vw;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s ease-out;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-spin {
            background: linear-gradient(135deg, var(--santa-red), #800000);
            border: none;
            color: white;
            font-size: 1.8vw;
            padding: 2vh 6vh;
            box-shadow: 0 10px 30px rgba(196, 30, 58, 0.5), inset 0 2px 5px rgba(255,255,255,0.3);
        }

        button:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            border-color: var(--szixi-gold-bright);
        }
        
        button:active:not(:disabled) { transform: translateY(-2px); }

        button:disabled {
            filter: grayscale(0.8) brightness(0.7);
            cursor: not-allowed;
            transform: none;
        }

        .modal-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }
        
        .modal-overlay.active { opacity: 1; backdrop-filter: blur(15px); }

        .modal-content {
            background: linear-gradient(135deg, #111, #0a0a0a);
            border: 2px solid var(--szixi-gold);
            padding: 5vh;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 0 60px rgba(212, 175, 55, 0.2);
            max-width: 60vw;
            width: 90%;
            transform: scale(0.9);
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .modal-overlay.active .modal-content { transform: scale(1); }

        .winner-label {
            font-size: 1.5vw; 
            color: #aaa; 
            text-transform:uppercase; 
            letter-spacing: 2px;
            margin-bottom: 2vh;
        }

        .winner-name {
            font-size: 5vw;
            font-weight: 900;
            background: linear-gradient(to right, #fff, var(--szixi-gold-bright));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 3vh 0;
            text-shadow: 0 5px 20px rgba(212, 175, 55, 0.3);
            line-height: 1.1;
        }
        
        .final-message {
            font-size: 3vw;
            color: var(--szixi-gold-bright);
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            background: rgba(255,255,255,0.05);
            border: 2px solid #333;
            color: var(--szixi-gold-bright);
            padding: 20px;
            height: 20vh;
            border-radius: 15px;
            margin-bottom: 3vh;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2vw;
            resize: none;
        }
        textarea:focus { outline: none; border-color: var(--szixi-gold); }

    </style>
</head>
<body>

    <div class="app-container">
        
        <div class="snow-layer" id="snowLayer"></div>

        <div class="sidebar">
            <div class="logo-box">
                <img src="https://i.ibb.co/BVY28GSb/1000003127-1.png" alt="Szixi Logo" onerror="this.style.display='none'; this.parentElement.style.height='auto'">
            </div>
            <h1>Sz√©chenyi<br>Mikul√°s</h1>
            <div class="subtitle">√únnepi Sorsol√°s</div>
            
            <div class="stats-container">
                <div class="stat-box">
                    <div class="counter-number" id="namesCounter">0</div>
                    <div class="counter-label">N√©v a kalapban</div>
                </div>
                <div class="stat-box">
                    <div class="counter-number" id="spinsLeftCounter">0</div>
                    <div class="counter-label">H√°tral√©v≈ë p√∂rget√©s</div>
                </div>
            </div>
        </div>

        <div class="wheel-section">
            <div class="wheel-wrapper-relative">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <canvas id="wheelCanvas" width="1200" height="1200"></canvas>
                    <div class="center-hub">
                        <span>üéÖ</span>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn-spin" id="spinBtn" onclick="spin()">P√ñRGET√âS!</button>
            </div>
        </div>

        <div class="modal-overlay" id="editModal">
            <div class="modal-content">
                <h2 style="color:var(--szixi-gold); font-size: 2vw; margin-top:0;">N√©vsor Szerkeszt√©se</h2>
                <textarea id="namesInput" placeholder="Pl: 9.A, 10.B, Tan√°rok"></textarea>
                <div style="display: flex; justify-content: center; gap: 20px;">
                    <button onclick="saveNames()" class="btn-spin" style="font-size:1.2vw; padding: 1.5vh 4vh;">Ment√©s</button>
                    <button onclick="closeModal('editModal')">M√©gse</button>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="winnerModal">
            <div class="modal-content">
                <div class="winner-label">A szerencs√©s kiv√°lasztott:</div>
                <div class="winner-name" id="winnerText">???</div>
                <button class="btn-spin" onclick="acceptWinner()" style="font-size: 1.5vw;">Gratul√°lok!</button>
            </div>
        </div>

        <div class="modal-overlay" id="gameOverModal">
            <div class="modal-content">
                <div style="font-size: 5vw;">üéÑüéÅ</div>
                <h2 class="final-message">Gratul√°lunk a nyerteseknek!</h2>
                <p style="color:#aaa; font-size: 1.2vw;">A sorsol√°s v√©get √©rt. Kellemes √ºnnepeket!</p>
                <button onclick="closeModal('gameOverModal')" style="margin-top:20px;">Bez√°r√°s</button>
            </div>
        </div>

    </div>

    <script>
        let totalSpinsAllowed = 11;

        let names = ["√Åd√°m Ram√≥na 10A", "Egri Eszter 10A", "Farkas Bianka 10A", "Ferge Di√°na 10A", "G√©czy S√°ra 10A", "Ha√°sz Barbara Ilona 10A", "Hideg Anna Katalin 10A", "K√©ri G√°bor 10A", "Kov√°cs Anna Eszter 10A", "Kov√°cs Zolt√°n 10A", "Lohr Dzsenifer Vanessza 10A", "Marosi Zo√© Merc√©desz 10A", "Milotai Bence 10A", "Nagy Hanna 10A", "Nedermann Lilien 10A", "Papp Kriszti√°n 10A", "S√°mp√°r Vanda J√°zmin 10A", "Simon M√°t√© 10A", "Sztojkovics Dorina 10A", "Talab√©r Csenge Anna 10A", "Volf Melissza 10A", "Balassa B√°lint 10B", "Balogh Krisztina 10B", "Barna D√°vid Kriszti√°n 10B", "Csemez N√°ndor M√°ty√°s 10B", "Dombi Petra 10B", "Eisemann Fl√≥ra 10B", "G√°bor Zsolt 10B", "G√©czy Bence G√°bor 10B", "Horv√°th-Morvai Reg≈ë Csaba 10B", "Kecsk√©s M√°rk 10B", "Kiss Bence 10B", "Lipovics M√°t√© Istv√°n 10B", "Micsunek L√°szl√≥ Zolt√°n 10B", "M√≥rocz Elizabet Eunik√© 10B", "M√≥zsik Dominik 10B", "Musitz √Åd√°m 10B", "Nagy Dominik Kriszti√°n 10B", "Nagy Tam√°s 10B", "Ny√°ri M√°t√© 10B", "Seres Gr√©ta 10B", "Szab√≥ M√°rk 10B", "Szigeti M√°t√© 10B", "Szilv√°sy R√≥bert Jen≈ë 10B", "T√∂r√∂k Krist√≥f 10B", "T√∂r√∂k Roland 10B", "Varga Attila Botond 10B", "Vida Botond 10B", "Vida Erik 10B", "Babir√°k √Åbel 11A", "Bedecs Vivien 11A", "Bereczki Marcell Andr√°s 11A", "Bezzeg No√©mi 11A", "Bogn√°r Csenge 11A", "Csima Tamara 11A", "Fermans Bence Kobe 11A", "Gerencs√©r Zsaklin Gabriella 11A", "Gy≈±r√ºsi G√°bor Vince 11A", "Ha√°sz Ren√°ta M√°ria 11A", "Harcsa Barnab√°s 11A", "Hemmerlein Em√≠lia 11A", "Jakatics Lili 11A", "Kondor √Åd√°m P√©ter 11A", "K√≥tyi Eszter 11A", "L√°mer Attila 11A", "Lunczer √Åd√°m D√°vid 11A", "M√©sz√°ros Zs√≥fia 11A", "√ñrd√∂g Zolt√°n 11A", "Pulai Dorka 11A", "So√≥s L√©na Sz√≥fia 11A", "S√ºmegi Lea 11A", "Szalai Sz√≥fia Valentina 11A", "Sz√©csi Joel 11A", "Varga Petra N√≥ra 11A", "Vencz√°k-Csoboly√≥ Zsombor 11A", "Zsoldos Krisztofer 11A", "Altsach Noel 11B", "Brey Bence P√©ter 11B", "Eipl D√°niel 11B", "Farkas Laura Helga 11B", "Hajnal Nataniel 11B", "Halmai √Åd√°m 11B", "Haris M√°t√© 11B", "Heller Barnab√°s 11B", "Hermann D√°niel 11B", "Hily√°k Bendeg√∫z 11B", "Horv√°th M√°rk 11B", "J√°rf√°s Zolt√°n 11B", "K√°fony-H√°zi Kolos 11B", "Kerekes Konr√°d D√°vid 11B", "Kiss Zsolt 11B", "Kulhanek K√≠ra 11B", "Orb√°n Tibor 11B", "S√°ri Levente 11B", "Szijj√°rt√≥ √Åron 11B", "Szuri Dorina 11B", "Szvath Gergely J√≥n√°s 11B", "Tak√°cs D√°niel 11B", "Tak√°cs P√©ter Bence 11B", "T√≥th Zsombor Imre 11B", "T√≥th-Kurucz Alexander 11B", "V√∂r√∂s Attila Zsombor 11B", "Vulcan Kevin Raul 11B", "Alexovics Dami√°n 11C", "Bak√≥ Laura Vincencia 11C", "Baricza M√°rk 11C", "Bazs√°nt Krist√≥f 11C", "Bucsku Dzsenifer 11C", "D√°kai Ferenc Barnab√°s 11C", "Deli D√≥ra Tamara 11C", "Elekes D√°niel 11C", "G√°bor Levente 11C", "Gergely Vivien 11C", "Gugg Imre 11C", "Haris Zo√© 11C", "Herdics Bogl√°rka Dea 11C", "Juh√°sz Dzsenifer 11C", "Lavicza Dominik M√°t√© 11C", "Magyar D√°niel 11C", "M√©sz√°ros M√°t√© 11C", "M√©sz√°ros Panna T√≠mea 11C", "P√°pai Tam√°s Gy√∂rgy 11C", "Simon T√≠mea 11C", "Szab√≥ Tam√°s Zolt√°n 11C", "Vizi √âva Kinga 11C", "Balogh Levente 12A", "Bir√≥ Gerg≈ë 12A", "Bova Bence Kriszti√°n 12A", "Czunyi Domonkos 12A", "Dallos Attila L√≥r√°nt 12A", "Fodor Zs√≥fi 12A", "Horv√°th Andr√°s 12A", "Horv√°th Attila 12A", "Horv√°th Tibor J√°nos 12A", "Juh√°sz P√©ter 12A", "Kelemen Bence 12A", "Kocsi Bogl√°rka 12A", "Kondor Fanni 12A", "K√≥sa Krist√≥f Tam√°s 12A", "Lakatos Martin D√°niel 12A", "Lengyel M√°t√© 12A", "Marcink√≥ Korn√©l 12A", "Mohos Vikt√≥ria 12A", "Nagy S√°ndor 12A", "Nov√°k √Åron 12A", "√ìv√°ry Gerg≈ë 12A", "P√°lfi Panna 12A", "Pauer Krist√≥f Barnab√°s 12A", "P√°va Zsombor 12A", "Reszter Adri√°n 12A", "Sz√∂ll≈ësi N√≥ra 12A", "Sz≈±r Alexandra Fl√≥ra 12A", "Szvoboda Zora Kata 12A", "T√≥th Bettina 12A", "T√≥th Eliza Krisztina 12A", "Varga Vikt√≥ria 12A", "Andalik Gerg≈ë 12B", "Anga M√°rk 12B", "Argai Alex 12B", "Bohos Dominika 12B", "B√∂r√∂cz R√≥bert 12B", "Cs√∂llei Gerg≈ë Bal√°zs 12B", "Dorogi J√°nos Martin 12B", "F√°bi√°n Bal√°zs 12B", "Ferge M√°rk 12B", "Haklits Hanga Hanna 12B", "Horv√°th Krist√≥f 12B", "Kerekes Eliot 12B", "Koncz Katrin Sarolta 12B", "Ko√≥s √Åd√°m 12B", "Kov√°cs √Åron 12B", "M√©sz√°ros √Åron 12B", "Moln√°r √Åd√°m 12B", "Moln√°r √Åkos 12B", "Nagy P√©ter Bal√°zs 12B", "Nagyszegi Zsombor Bendeg√∫z 12B", "Rost√°s Raul 12B", "Schmidt Patrik 12B", "Sebesty√©n K√°rmen Gertr√∫d 12B", "Szil√°gyi S√°ra 12B", "Tihanyi Szabolcs Bendeg√∫z 12B", "T√≥th Elmira 12B", "T√∂r√∂k Bence 12B", "T√∂r√∂k M√°t√© 12B", "Urb√°n Kevin Noel 12B", "Bajcsai T√≠mea √âva 13A", "Bocskor Korn√©l Zal√°n 13A", "Dabasi Bal√°zs 13A", "F√∂demes Gr√©ta 13A", "Gyurcsek Martin Tam√°s 13A", "Han Yewon 13A", "Heller Barbara 13A", "H√©rics R√©ka 13A", "Horv√°th Eperke Fel√≠cia 13A", "Horv√°th Istv√°n 13A", "Kiss Rebeka 13A", "Kiss Szil√°rd Erik 13A", "Koncz Norina 13A", "Magura No√©mi 13A", "M√≥ricz M√°t√© 13A", "Musicz N√≥ra 13A", "Nyemcsok Ferenc 13A", "R√°di Hanna Gabriella 13A", "Sipos-Szab√≥ D√©nes 13A", "Tak√°cs R√≥bert 13A", "Teidl Zal√°n Tibor 13A", "Tippan Stella Katrin 13A", "T√≥th Szabolcs 13A", "Tur√°n Dzsenifer Petra 13A", "V√°rnai Viktor 13A", "Virizlai Benedek 13A", "Adamik Gy√∂rgy Zsombor 13B", "B√°n P√©ter 13B", "Baranya Bettina 13B", "Bedecs Bianka 13B", "Bedecs D√°niel 13B", "Fejes M√°t√© 13B", "Fekete M√°rton 13B", "Horv√°th Dorina 13B", "Horv√°th Rebeka 13B", "Ill√©s Marcell 13B", "J√°rf√°s Barna Szabolcs 13B", "Jezerniczky M√°t√© 13B", "Kucera √Åd√°m 13B", "Kurica Istv√°n 13B", "Marton Marcell G√°bor 13B", "Maz√°n-Jankovics Vikt√≥ria 13B", "Mik√≥ Vikt√≥ria 13B", "Mogyor√≥si Kinga 13B", "Moln√°r M√°rk 13B", "Nagy Anna Krisztina 13B", "R√≥ka P√©ter 13B", "Sim√≥ Erik 13B", "T√≥th Zsolt Bence 13B", "Varga M√°t√© 13B", "Verest√≥i Vanda L√©na 13B", "√Ånyos Lajos Tam√°s 9A", "Czibor Maja 9A", "Ha√°sz T√≠mea 9A", "Horv√°th Hel√©na Patr√≠cia 9A", "K√≥sa Rebeka 9A", "Lakatos Vir√°g Anik√≥ 9A", "Li Borui 9A", "Matics Lili N√≥ra 9A", "Milcsik Bence 9A", "Moln√°r Hanga 9A", "Novotni Vanessza 9A", "P√©nzes Panka J√°zmin 9A", "Pirik D√°niel 9A", "R√°cz Elizabet 9A", "Szab√≥ Laura 9A", "Szab√≥ Raul Gy√∂rgy 9A", "Szigeti N√≥ra 9A", "Varga Alexandra Alojzia 9A", "Angyal Tam√°s 9B", "Asb√≥th L√°szl√≥ Dus√°n 9B", "Bedecs Krist√≥f 9B", "Bozori Gerg≈ë 9B", "Czita Levente 9B", "Danis Bence 9B", "√âzs√∂l Tam√°s 9B", "Farkas D√°vid Tibor 9B", "Feh√©r Korn√©l √Åron 9B", "Gorzs√°s M√°rk 9B", "Hartmann M√°rk 9B", "Kecsk√©s Kriszti√°n N√°ndor 9B", "Kecsk√©s Levente 9B", "Krizsan Andr√°s Viktor 9B", "Kurucz P√©ter 9B", "Kusty√°n Tam√°s Dominik 9B", "Lelovics Levente 9B", "Mag √Åd√°m 9B", "Majern√≠k B√°lint 9B", "Majorosi Miron Mih√°ly 9B", "Moln√°r Kriszti√°n 9B", "N√©meth M√°rk 9B", "Samai Szil√°rd 9B", "Szab√≥ G√°bor 9B", "Szab√≥ R√≥bert Rich√°rd 9B", "Szalai Dominik Ferenc 9B", "Titarenko Veronika 9B", "T√∂r√∂k Zal√°n 9B", "Ugri Attila 9B", "Veszpr√©mi Barnab√°s 9B"];
        let spinsLeft = totalSpinsAllowed;
        const colors = ["#001a45", "#a3162e", "#b08d26", "#002664", "#C41E3A", "#D4AF37"]; 
        let startAngle = 0;
        let arc = Math.PI / (names.length / 2);
        let spinVelocity = 0;
        let isSpinning = false;
        let ctx;
        const canvasSize = 1200;
        const canvas = document.getElementById("wheelCanvas");
        
        window.onload = function() {
            ctx = canvas.getContext("2d");
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            createSnow();
            updateStats();
            drawWheel();
        };

        function drawWheel() {
            if (names.length === 0) {
                ctx.clearRect(0,0,canvasSize, canvasSize);
                return;
            }

            const outsideRadius = canvasSize / 2 - 20;
            const centerX = canvasSize / 2;
            const centerY = canvasSize / 2;

            arc = 2 * Math.PI / names.length;
            ctx.clearRect(0, 0, canvasSize, canvasSize);

            let activeIndex = -1;
            if (names.length > 0) {
                 const degrees = startAngle % (2 * Math.PI);
                 const indexOffset = Math.floor(((2 * Math.PI - (degrees + Math.PI/2) % (2 * Math.PI))) / arc);
                 activeIndex = (names.length + indexOffset) % names.length;
            }

            for(let i = 0; i < names.length; i++) {
                const angle = startAngle + i * arc;
                const isActive = (i === activeIndex);
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, outsideRadius, angle, angle + arc);
                ctx.lineTo(centerX, centerY);
                
                ctx.fillStyle = isActive ? lightenColor(colors[i % colors.length], 20) : colors[i % colors.length];
                ctx.fill();
                
                ctx.strokeStyle = "rgba(255,255,255,0.15)";
                ctx.lineWidth = 3;
                ctx.stroke();

                if (names.length < 100) {
                    ctx.save();
                    
                    ctx.translate(centerX, centerY);
                    
                    ctx.rotate(angle + arc / 2);
                    
                    ctx.translate(outsideRadius - 50, 0);
                    
                    ctx.textAlign = "right";
                    ctx.textBaseline = "middle";

                    const text = names[i];
                    
                    if (isActive) {
                        let baseFontSize = names.length > 20 ? 40 : 60;
                        ctx.font = `900 ${baseFontSize}px Montserrat, sans-serif`;
                        ctx.fillStyle = "#FFD700";
                        ctx.shadowColor = "#FFD700";
                        ctx.shadowBlur = 30;
                    } else {
                        let baseFontSize = names.length > 20 ? 25 : 45;
                        ctx.font = `700 ${baseFontSize}px Montserrat, sans-serif`;
                        ctx.fillStyle = "rgba(255,255,255,0.9)";
                        ctx.shadowColor = "rgba(0,0,0,0.5)";
                        ctx.shadowBlur = 5;
                    }
                    
                    ctx.fillText(text, 0, 0);
                    ctx.restore();
                }
            }
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, outsideRadius + 10, 0, 2 * Math.PI);
            ctx.lineWidth = 25;
            let gradient = ctx.createLinearGradient(0, 0, canvasSize, canvasSize);
            gradient.addColorStop(0, "#D4AF37");
            gradient.addColorStop(0.5, "#FFD700");
            gradient.addColorStop(1, "#D4AF37");
            ctx.strokeStyle = gradient;
            ctx.stroke();
        }

        function spin() {
            if(isSpinning || names.length === 0 || spinsLeft <= 0) return;
            
            isSpinning = true;
            document.getElementById("spinBtn").disabled = true;
            spinVelocity = Math.random() * 0.4 + 0.6; 
            requestAnimationFrame(rotateWheel);
        }

        function rotateWheel() {
            startAngle += spinVelocity;
            spinVelocity *= 0.988;

            drawWheel();

            if (spinVelocity > 0.0015) {
                requestAnimationFrame(rotateWheel);
            } else {
                stopRotateWheel();
            }
        }

        function stopRotateWheel() {
            isSpinning = false;
            
            const degrees = startAngle % (2 * Math.PI);
            const indexOffset = Math.floor(((2 * Math.PI - (degrees + Math.PI/2) % (2 * Math.PI))) / arc);
            const winningIndex = (names.length + indexOffset) % names.length;
            
            drawWheel();
            setTimeout(() => { showWinner(winningIndex); }, 500);
        }

        let currentWinnerIndex = -1;

        function showWinner(index) {
            currentWinnerIndex = index;
            const text = names[index];
            document.getElementById("winnerText").innerText = text;
            
            const modal = document.getElementById("winnerModal");
            modal.style.display = "flex";
            modal.offsetHeight; 
            modal.classList.add("active");
        }

        function acceptWinner() {
            if(currentWinnerIndex > -1) {
                names.splice(currentWinnerIndex, 1);
                currentWinnerIndex = -1;
                
                spinsLeft--;
                updateStats();
                
                closeModal('winnerModal');
                
                if(spinsLeft <= 0) {
                    setTimeout(() => {
                        const goModal = document.getElementById("gameOverModal");
                        goModal.style.display = "flex";
                        goModal.offsetHeight;
                        goModal.classList.add("active");
                        document.getElementById("spinBtn").disabled = true;
                    }, 500);
                } else {
                    document.getElementById("spinBtn").disabled = false;
                }
                
                drawWheel();
            }
        }

        function updateStats() {
            document.getElementById("namesCounter").innerText = names.length;
            document.getElementById("spinsLeftCounter").innerText = spinsLeft;
            
            if(spinsLeft <= 0) {
                document.getElementById("spinBtn").disabled = true;
            }
        }

        function openEdit() {
            document.getElementById("namesInput").value = names.join(", ");
            const modal = document.getElementById("editModal");
            modal.style.display = "flex";
            modal.offsetHeight;
            modal.classList.add("active");
        }

        function saveNames() {
            const val = document.getElementById("namesInput").value;
            const newNames = val.split(/[,\n;]+/).map(s => s.trim()).filter(s => s.length > 0);
            
            if(newNames.length > 0) {
                names = newNames;
                startAngle = 0;
                updateStats();
                drawWheel();
                closeModal('editModal');
            } else {
                alert("K√©rlek adj meg legal√°bb egy nevet!");
            }
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            modal.classList.remove("active");
            setTimeout(() => modal.style.display = "none", 400);
        }

        function lightenColor(color, percent) {
            let num = parseInt(color.replace("#",""),16),
            amt = Math.round(2.55 * percent),
            R = (num >> 16) + amt,
            B = (num >> 8 & 0x00FF) + amt,
            G = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 + (B<255?B<1?0:B:255)*0x100 + (G<255?G<1?0:G:255)).toString(16).slice(1);
        }

        function createSnow() {
            const container = document.getElementById("snowLayer");
            const count = 40; 
            let html = "";
            for(let i=0; i<count; i++) {
                const left = Math.random() * 100;
                const dur = Math.random() * 10 + 10;
                const size = Math.random() * 4 + 2;
                const delay = Math.random() * -20;
                html += `<div style="
                    position:absolute; 
                    left:${left}%; 
                    top:-20px; 
                    width:${size}px; 
                    height:${size}px; 
                    background:rgba(255,255,255,0.4); 
                    border-radius:50%; 
                    filter: blur(1px);
                    animation: fall ${dur}s linear infinite;
                    animation-delay: ${delay}s;"></div>`;
            }
            container.innerHTML = html + `<style>@keyframes fall{to{transform:translateY(110vh) rotate(360deg);}}</style>`;
        }
    </script>
</body>
</html>





